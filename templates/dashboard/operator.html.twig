{% extends 'admin/base.html.twig' %}

{% block title %}Operator Dashboard ¬∑ Patchstash{% endblock %}

{% block admin_content %}
<div class="page-head">
    <div>
        <p class="eyebrow">Dashboard</p>
        <h1>Operator</h1>
        <p class="text-muted">Manage patches, vulnerabilities, and assets.</p>
    </div>
</div>

<div class="admin-section" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.2rem; margin-bottom: 2rem;">
    <div class="stat-card">
        <div class="stat-meta">
            <p class="stat-label">Accessible Projects</p>
            <p class="stat-value">{{ totalProjects }}</p>
        </div>
        <div class="stat-icon">üìÅ</div>
    </div>
    <div class="stat-card">
        <div class="stat-meta">
            <p class="stat-label">Role</p>
            <p class="stat-value" style="font-size: 1.5rem;">Operator</p>
        </div>
        <div class="stat-pill">Patch Ops</div>
    </div>
</div>

<div class="admin-panel">
    <div class="panel-header">
        <div>
            <h2>Available Projects</h2>
            <p class="text-muted">Projects requiring operational support</p>
        </div>
        {% if projects|length > 0 %}
             <a class="btn primary" href="{{ path('app_project_index') }}">View all</a>
        {% endif %}
    </div>
    
    {% if projects|length > 0 %}
    <div class="admin-table">
        <table>
            <thead>
                <tr>
                    <th>Project</th>
                    <th>Description</th>
                    <th>Modules</th>
                    <th class="text-end">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for project in projects|slice(0, 5) %}
                <tr>
                    <td><strong>{{ project.name }}</strong></td>
                    <td class="text-muted">{{ project.description|striptags|slice(0, 60) }}...</td>
                    <td><span class="badge low">{{ project.modules|length }} Modules</span></td>
                    <td class="text-end">
                        <a class="btn ghost small" href="{{ path('app_project_show', {'id': project.id}) }}">View</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="empty-state" style="padding: 3rem; text-align: center;">
        <p class="text-muted">You don't have access to any projects yet.</p>
    </div>
    {% endif %}
</div>

<div class="admin-section" style="margin-top: 2rem;">
    <div class="admin-panel">
        <div class="panel-header">
            <h2>Operational Tools</h2>
        </div>
        <div class="quick-actions">
            <a href="{{ path('app_patch_cycle_index') }}" class="action-card" style="text-decoration: none;">
                <h3 style="margin:0; color:#f8fafc; font-size:1rem;">‚öôÔ∏è Patch Cycles</h3>
                <p class="text-muted" style="font-size:0.85rem; margin:0;">Manage patch windows and deployments</p>
                <span class="badge medium" style="width: fit-content; margin-top:0.5rem;">Primary</span>
            </a>
            <a href="{{ path('app_vulnerability_index') }}" class="action-card" style="text-decoration: none;">
                <h3 style="margin:0; color:#f8fafc; font-size:1rem;">‚ö†Ô∏è Vulnerabilities</h3>
                <p class="text-muted" style="font-size:0.85rem; margin:0;">Track and remediate security risks</p>
                <span class="badge critical" style="width: fit-content; margin-top:0.5rem;">High Priority</span>
            </a>
            <a href="{{ path('app_asset_index') }}" class="action-card" style="text-decoration: none;">
                <h3 style="margin:0; color:#f8fafc; font-size:1rem;">üñ•Ô∏è Assets</h3>
                <p class="text-muted" style="font-size:0.85rem; margin:0;">Inventory of systems and components</p>
            </a>
            <a href="{{ path('app_module_index') }}" class="action-card" style="text-decoration: none;">
                <h3 style="margin:0; color:#f8fafc; font-size:1rem;">üì¶ Modules</h3>
                <p class="text-muted" style="font-size:0.85rem; margin:0;">Service areas requiring updates</p>
            </a>
        </div>
    </div>
</div>
{% endblock %}
