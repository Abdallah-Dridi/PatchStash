{% extends 'admin/base.html.twig' %}

{% block title %}Vulnerability Â· {{ vulnerability.cveId }}{% endblock %}

{% block admin_content %}
<div class="page-head">
    <div>
        <p class="eyebrow">Vulnerability</p>
        <h1>{{ vulnerability.cveId }}</h1>
        <p class="text-muted">Severity, CVSS, and remediation context.</p>
    </div>
    <div class="actions">
        <a class="btn ghost" href="{{ path('app_vulnerability_index') }}">Back</a>
        <a class="btn primary" href="{{ path('app_vulnerability_edit', {'cveId': vulnerability.cveId}) }}">Edit</a>
    </div>
</div>

<div class="admin-panel">
    <div class="meta-grid">
        <div class="detail-block">
            <p class="text-muted">Title</p>
            <p>{{ vulnerability.name }}</p>
        </div>
        <div class="detail-block">
            <p class="text-muted">Severity</p>
            {% set sev = vulnerability.severity|default('Medium') %}
            {% set sevClass = {
                'Critical': 'critical',
                'High': 'high',
                'Medium': 'medium',
                'Low': 'low'
            }[sev]|default('medium') %}
            <span class="badge {{ sevClass }}">{{ sev }}</span>
        </div>
        <div class="detail-block">
            <p class="text-muted">CVSS</p>
            {% set cvssScore = vulnerability.cvss|default(0) %}
            {% set cvssClass = cvssScore >= 9 ? 'critical' : (cvssScore >= 7 ? 'high' : (cvssScore >= 4 ? 'medium' : 'low')) %}
            <span class="badge {{ cvssClass }}">{{ cvssScore }}</span>
        </div>
        <div class="detail-block">
            <p class="text-muted">Patch cycle</p>
            <p>{{ vulnerability.patchCycle ? vulnerability.patchCycle.cycleId : 'Unassigned' }}</p>
        </div>
        <div class="detail-block">
            <p class="text-muted">Info</p>
            <p>{{ vulnerability.info|default('No additional context') }}</p>
        </div>
    </div>
    <div class="detail-block" style="margin-top:1rem;">
        <p class="text-muted">Description</p>
        <p>{{ vulnerability.description }}</p>
    </div>
</div>

{{ include('vulnerability/_delete_form.html.twig', { vulnerability: vulnerability }) }}
{% endblock %}
