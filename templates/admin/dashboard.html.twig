{% extends 'base.html.twig' %}

{% block title %}Admin Dashboard · Patchstash{% endblock %}

{% block body %}
    <div class="admin-layout">
        <aside class="admin-sidebar">
            <div class="admin-brand">
                <span class="admin-logo">⬢</span>
                Patchstash Admin
            </div>
            <nav class="admin-nav">
                <a class="active" href="{{ path('app_admin_dashboard') }}">Overview</a>
                <span class="nav-label">Directory</span>
                <a href="#">Users</a>
                <a href="#">Projects</a>
                <a href="#">Modules</a>
                <a href="#">Assets</a>
                <span class="nav-label">Operations</span>
                <a href="#">Patch Cycles</a>
                <a href="#">Vulnerabilities</a>
                <a href="#">Reports</a>
                <span class="nav-label">Configuration</span>
                <a href="#">Roles &amp; Permissions</a>
                <a href="#">Integrations</a>
            </nav>
        </aside>

        <div class="admin-content">
            <section>
                <header>
                    <h1>Platform overview</h1>
                    <p class="text-muted">High-level health across users, assets, and patch posture.</p>
                </header>

                <div class="admin-grid">
                    {% for stat in stats %}
                        <article class="stat-card">
                            <p class="stat-label">{{ stat.label }}</p>
                            <p class="stat-value">{{ stat.value }}</p>
                        </article>
                    {% endfor %}
                </div>
            </section>

            <section class="admin-section">
                <div class="admin-panel">
                    <h2>Upcoming patch cycles</h2>
                    <p class="text-muted">Soonest deadlines across all assets.</p>
                    <table>
                        <thead>
                            <tr>
                                <th>Cycle</th>
                                <th>Asset</th>
                                <th>Status</th>
                                <th>Deadline</th>
                            </tr>
                        </thead>
                        <tbody>
                        {% for cycle in recent_patch_cycles %}
                            <tr>
                                <td>{{ cycle.cycleId }}</td>
                                <td>{{ cycle.asset ? cycle.asset.name : 'Unassigned' }}</td>
                                <td>{{ cycle.status }}</td>
                                <td>{{ cycle.deadline ? cycle.deadline|date('M d, Y') : '—' }}</td>
                            </tr>
                        {% else %}
                            <tr>
                                <td colspan="4" class="text-muted">No patch cycles yet.</td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
                <div class="admin-panel">
                    <h2>Highest risk CVEs</h2>
                    <p class="text-muted">Top vulnerabilities sorted by CVSS.</p>
                    <table>
                        <thead>
                            <tr>
                                <th>CVE</th>
                                <th>Severity</th>
                                <th>CVSS</th>
                                <th>Patch Cycle</th>
                            </tr>
                        </thead>
                        <tbody>
                        {% for vuln in critical_vulnerabilities %}
                            <tr>
                                <td>{{ vuln.cveId }}</td>
                                <td>{{ vuln.severity }}</td>
                                <td>{{ vuln.cvss }}</td>
                                <td>{{ vuln.patchCycle ? vuln.patchCycle.cycleId : 'Unassigned' }}</td>
                            </tr>
                        {% else %}
                            <tr>
                                <td colspan="4" class="text-muted">No vulnerabilities recorded.</td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </section>
        </div>
    </div>
{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <style>
        .admin-layout {
            display: grid;
            grid-template-columns: 240px 1fr;
            min-height: calc(100vh - 3rem);
            background: #f1f5f9;
        }

        .admin-sidebar {
            background: #0f172a;
            color: #f8fafc;
            padding: 2rem 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            border-radius: 18px;
            margin-right: 1.5rem;
            height: calc(100vh - 4rem);
            position: sticky;
            top: 1rem;
        }

        .admin-brand {
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.6rem;
            font-size: 1.1rem;
        }

        .admin-logo {
            color: #a855f7;
            font-size: 1.4rem;
        }

        .admin-nav {
            display: flex;
            flex-direction: column;
            gap: 0.4rem;
        }

        .admin-nav a {
            color: rgba(248, 250, 252, 0.85);
            padding: 0.55rem 0.75rem;
            border-radius: 10px;
            transition: background 0.2s ease, color 0.2s ease;
        }

        .admin-nav a.active, .admin-nav a:hover {
            background: rgba(168, 85, 247, 0.15);
            color: #f8fafc;
        }

        .nav-label {
            margin-top: 1.2rem;
            font-size: 0.72rem;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            color: rgba(248, 250, 252, 0.55);
        }

        .admin-content {
            padding: 2rem;
        }

        .text-muted { color: #6b7280; font-size: 0.95rem; }
        section { margin-bottom: 2rem; }
        h1 { margin-bottom: 0.2rem; }
        .admin-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
        }
        .stat-card {
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 1.2rem 1.4rem;
            background: #fff;
            box-shadow: 0 10px 30px rgba(15, 23, 42, 0.05);
        }
        .stat-label { margin: 0; font-size: 0.9rem; color: #6b7280; }
        .stat-value { margin: 0.35rem 0 0; font-size: 1.9rem; font-weight: 600; color: #111827; }
        .admin-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 1.5rem;
        }
        .admin-panel {
            border: 1px solid #e5e7eb;
            border-radius: 16px;
            padding: 1.5rem;
            background: #fff;
            box-shadow: 0 15px 30px rgba(15, 23, 42, 0.08);
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        th, td {
            text-align: left;
            padding: 0.65rem 0.4rem;
            border-bottom: 1px solid #edf0f7;
        }
        th {
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #94a3b8;
        }
        tbody tr:last-child td {
            border-bottom: none;
        }
        @media (max-width: 1024px) {
            .admin-layout {
                grid-template-columns: 1fr;
            }

            .admin-sidebar {
                position: relative;
                height: auto;
                margin-right: 0;
                margin-bottom: 1rem;
                border-radius: 12px;
            }
        }
    </style>
{% endblock %}
