{% extends 'base.html.twig' %}

{% block title %}Choose new password · Patchstash{% endblock %}

{% block stylesheets %}
    {{ include('security/_auth_styles.html.twig') }}
    <style>
        .auth-card { width: min(580px, 100%); margin: 0 auto; padding: clamp(2.1rem, 4vw, 2.9rem); }
        .hint { color: var(--muted); font-size: 0.93rem; margin-top: -0.35rem; }
    </style>
{% endblock %}

{% block body_class %}auth-page{% endblock %}
{% block header %}{% endblock %}
{% block main_class %}auth-main{% endblock %}

{% block body %}
    <div class="auth-card">
        <div class="floating">
            <span class="blob a"></span>
            <span class="blob b"></span>
        </div>

        <p class="eyebrow">Reset password</p>
        <h2 class="auth-title">Set a new password</h2>
        <p class="auth-sub">For {{ user.email }}. Your reset link expires at {{ user.resetExpiresAt ? user.resetExpiresAt|date('H:i') ~ ' UTC' : 'expiry unknown' }}.</p>

        {% for label, messages in app.flashes %}
            {% for message in messages %}
                <div class="alert">{{ message }}</div>
            {% endfor %}
        {% endfor %}

        {% if error %}
            <div class="alert">{{ error }}</div>
        {% endif %}

        <form class="auth-form" method="post" action="{{ path('app_reset_password', { uid: user.id, token: user.resetToken }) }}">
            <div class="form-group">
                <label for="password">New password</label>
                <input id="password" name="password" type="password" placeholder="••••••••" required autocomplete="new-password">
                <p class="hint">Use at least 8 characters. Avoid reusing old passwords.</p>
            </div>

            <div class="form-group">
                <label for="confirm_password">Confirm password</label>
                <input id="confirm_password" name="confirm_password" type="password" placeholder="Repeat password" required autocomplete="new-password">
            </div>

            <button class="btn" type="submit">Update password</button>
        </form>

        <div class="auth-meta">
            Need a fresh link? <a href="{{ path('app_forgot_password') }}">Request another</a>
        </div>
    </div>
{% endblock %}
